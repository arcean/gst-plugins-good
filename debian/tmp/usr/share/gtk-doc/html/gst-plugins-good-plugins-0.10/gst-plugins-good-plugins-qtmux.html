<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>qtmux</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="index.html" title="GStreamer Good Plugins 0.10 Plugins Reference Manual">
<link rel="up" href="ch01.html" title="gst-plugins-good Elements">
<link rel="prev" href="gst-plugins-good-plugins-qtdemux.html" title="qtdemux">
<link rel="next" href="gst-plugins-good-plugins-qtmoovrecover.html" title="qtmoovrecover">
<meta name="generator" content="GTK-Doc V1.15 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="2">
<tr valign="middle">
<td><a accesskey="p" href="gst-plugins-good-plugins-qtdemux.html"><img src="left.png" width="24" height="24" border="0" alt="Prev"></a></td>
<td><a accesskey="u" href="ch01.html"><img src="up.png" width="24" height="24" border="0" alt="Up"></a></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="24" height="24" border="0" alt="Home"></a></td>
<th width="100%" align="center">GStreamer Good Plugins 0.10 Plugins Reference Manual</th>
<td><a accesskey="n" href="gst-plugins-good-plugins-qtmoovrecover.html"><img src="right.png" width="24" height="24" border="0" alt="Next"></a></td>
</tr>
<tr><td colspan="5" class="shortcuts">
<a href="#gst-plugins-good-plugins-qtmux.synopsis" class="shortcut">Top</a>
                   | 
                  <a href="#gst-plugins-good-plugins-qtmux.description" class="shortcut">Description</a>
                   | 
                  <a href="#gst-plugins-good-plugins-qtmux.properties" class="shortcut">Properties</a>
</td></tr>
</table>
<div class="refentry" title="qtmux">
<a name="gst-plugins-good-plugins-qtmux"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2><span class="refentrytitle"><a name="gst-plugins-good-plugins-qtmux.top_of_page"></a>qtmux</span></h2>
<p>qtmux — Muxer for quicktime(.mov) files</p>
</td>
<td valign="top" align="right"></td>
</tr></table></div>
<div class="refsynopsisdiv" title="Synopsis">
<a name="gst-plugins-good-plugins-qtmux.synopsis"></a><h2>Synopsis</h2>
<pre class="synopsis">                    <a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux" title="GstQTMux">GstQTMux</a>;
</pre>
</div>
<div class="refsect1" title="Properties">
<a name="gst-plugins-good-plugins-qtmux.properties"></a><h2>Properties</h2>
<pre class="synopsis">
  "<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--dts-method" title='The "dts-method" property'>dts-method</a>"               <span class="type">GstQTMuxDtsMethods</span>    : Read / Write / Construct
  "<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--faststart" title='The "faststart" property'>faststart</a>"                <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gboolean"><span class="type">gboolean</span></a>              : Read / Write
  "<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--faststart-file" title='The "faststart-file" property'>faststart-file</a>"           <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gchar"><span class="type">gchar</span></a>*                : Read / Write / Construct
  "<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--fragment-duration" title='The "fragment-duration" property'>fragment-duration</a>"        <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint"><span class="type">guint</span></a>                 : Read / Write / Construct
  "<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--moov-recovery-file" title='The "moov-recovery-file" property'>moov-recovery-file</a>"       <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gchar"><span class="type">gchar</span></a>*                : Read / Write / Construct
  "<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--movie-timescale" title='The "movie-timescale" property'>movie-timescale</a>"          <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint"><span class="type">guint</span></a>                 : Read / Write / Construct
  "<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--presentation-time" title='The "presentation-time" property'>presentation-time</a>"        <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gboolean"><span class="type">gboolean</span></a>              : Read / Write / Construct
  "<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--streamable" title='The "streamable" property'>streamable</a>"               <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gboolean"><span class="type">gboolean</span></a>              : Read / Write / Construct
  "<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--trak-timescale" title='The "trak-timescale" property'>trak-timescale</a>"           <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint"><span class="type">guint</span></a>                 : Read / Write / Construct
</pre>
</div>
<div class="refsect1" title="Description">
<a name="gst-plugins-good-plugins-qtmux.description"></a><h2>Description</h2>
<p>
This element merges streams (audio and video) into QuickTime(.mov) files.
</p>
<p>
The following background intends to explain why various similar muxers
are present in this plugin.
</p>
<p>
The <a class="ulink" href="http://www.apple.com/quicktime/resources/qtfileformat.pdf" target="_top">
QuickTime file format specification</a> served as basis for the MP4 file
format specification (mp4mux), and as such the QuickTime file structure is
nearly identical to the so-called ISO Base Media file format defined in
ISO 14496-12 (except for some media specific parts).
In turn, the latter ISO Base Media format was further specialized as a
Motion JPEG-2000 file format in ISO 15444-3 (mj2mux)
and in various 3GPP(2) specs (gppmux).
The fragmented file features defined (only) in ISO Base Media are used by
ISMV files making up (a.o.) Smooth Streaming (ismlmux).
</p>
<p>
A few properties (<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--movie-timescale" title='The "movie-timescale" property'>movie-timescale</a>,
<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--trak-timescale" title='The "trak-timescale" property'>trak-timescale</a>) allow adjusting
some technical parameters, which might be useful in (rare) cases to resolve
compatibility issues in some situations.
</p>
<p>
Some other properties influence the result more fundamentally.
A typical mov/mp4 file's metadata (aka moov) is located at the end of the file,
somewhat contrary to this usually being called "the header".
However, a <a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--faststart" title='The "faststart" property'>faststart</a> file will
(with some effort) arrange this to be located near start of the file,
which then allows it e.g. to be played while downloading.
Alternatively, rather than having one chunk of metadata at start (or end),
there can be some metadata at start and most of the other data can be spread
out into fragments of <a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--fragment-duration" title='The "fragment-duration" property'>fragment-duration</a>.
If such fragmented layout is intended for streaming purposes, then
<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--streamable" title='The "streamable" property'>streamable</a> allows foregoing to add
index metadata (at the end of file).
</p>
<p>
<a class="link" href="gst-plugins-good-plugins-qtmux.html#GstQTMux--dts-method" title='The "dts-method" property'>dts-method</a> allows selecting a
method for managing input timestamps (stay tuned for 0.11 to have this
automagically settled).  The default delta/duration method should handle nice
(aka perfect streams) just fine, but may experience problems otherwise
(e.g. input stream with re-ordered B-frames and/or with frame dropping).
The re-ordering approach re-assigns incoming timestamps in ascending order
to incoming buffers and offers an alternative in such cases.  In cases where
that might fail, the remaining method can be tried, which is exact and
according to specs, but might experience playback on not so spec-wise players.
Note that this latter approach also requires one to enable
presentation-timestamp.
</p>
<div class="refsect2" title="Example pipelines">
<a name="id386342"></a><h3>Example pipelines</h3>
<div class="informalexample">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1</pre></td>
        <td class="listing_code"><pre class="programlisting">gst-launch v4l2src num-buffers=<span class="number">500</span> ! video/x-raw-yuv,width=<span class="number">320</span>,height=<span class="number">240</span> ! ffmpegcolorspace ! qtmux ! filesink location=video.mov</pre></td>
      </tr>
    </tbody>
  </table>
</div>

Records a video stream captured from a v4l2 device and muxes it into a qt file.
</div>
<p>
Last reviewed on 2010-12-03
</p>
</div>
<div class="refsect1" title="Details">
<a name="gst-plugins-good-plugins-qtmux.details"></a><h2>Details</h2>
<div class="refsect2" title="GstQTMux">
<a name="GstQTMux"></a><h3>GstQTMux</h3>
<pre class="programlisting">typedef struct {
  GstElement element;

  GstPad *srcpad;
  GstCollectPads *collect;
  GSList *sinkpads;

  /* state */
  GstQTMuxState state;

  /* size of header (prefix, atoms (ftyp, mdat)) */
  guint64 header_size;
  /* accumulated size of raw media data (a priori not including mdat header) */
  guint64 mdat_size;
  /* position of mdat atom (for later updating) */
  guint64 mdat_pos;

  /* keep track of the largest chunk to fine-tune brands */
  GstClockTime longest_chunk;

  /* atom helper objects */
  AtomsContext *context;
  AtomFTYP *ftyp;
  AtomMOOV *moov;
  GSList *extra_atoms; /* list of extra top-level atoms (e.g. UUID for xmp)
                        * Stored as AtomInfo structs */

  /* fragmented file index */
  AtomMFRA *mfra;

  /* fast start */
  FILE *fast_start_file;

  /* moov recovery */
  FILE *moov_recov_file;

  /* fragment sequence */
  guint32 fragment_sequence;

  /* properties */
  guint32 timescale;
  guint32 trak_timescale;
  AtomsTreeFlavor flavor;
  gboolean fast_start;
  gboolean guess_pts;
  gint dts_method;
  gchar *fast_start_file_path;
  gchar *moov_recov_file_path;
  guint32 fragment_duration;
  gboolean streamable;

  /* for collect pads event handling function */
  GstPadEventFunction collect_event;

  /* for request pad naming */
  guint video_pads, audio_pads;
} GstQTMux;
</pre>
<p>
</p>
</div>
</div>
<div class="refsect1" title="Property Details">
<a name="gst-plugins-good-plugins-qtmux.property-details"></a><h2>Property Details</h2>
<div class="refsect2" title='The "dts-method" property'>
<a name="GstQTMux--dts-method"></a><h3>The <code class="literal">"dts-method"</code> property</h3>
<pre class="programlisting">  "dts-method"               <span class="type">GstQTMuxDtsMethods</span>    : Read / Write / Construct</pre>
<p>Method to determine DTS time.</p>
<p>Default value: reorder</p>
</div>
<hr>
<div class="refsect2" title='The "faststart" property'>
<a name="GstQTMux--faststart"></a><h3>The <code class="literal">"faststart"</code> property</h3>
<pre class="programlisting">  "faststart"                <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gboolean"><span class="type">gboolean</span></a>              : Read / Write</pre>
<p>If the file should be formatted for faststart (headers first).</p>
<p>Default value: FALSE</p>
</div>
<hr>
<div class="refsect2" title='The "faststart-file" property'>
<a name="GstQTMux--faststart-file"></a><h3>The <code class="literal">"faststart-file"</code> property</h3>
<pre class="programlisting">  "faststart-file"           <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gchar"><span class="type">gchar</span></a>*                : Read / Write / Construct</pre>
<p>File that will be used temporarily to store data from the stream when creating a faststart file. If null a filepath will be created automatically.</p>
<p>Default value: NULL</p>
</div>
<hr>
<div class="refsect2" title='The "fragment-duration" property'>
<a name="GstQTMux--fragment-duration"></a><h3>The <code class="literal">"fragment-duration"</code> property</h3>
<pre class="programlisting">  "fragment-duration"        <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint"><span class="type">guint</span></a>                 : Read / Write / Construct</pre>
<p>Fragment durations in ms (produce a fragmented file if &gt; 0).</p>
<p>Default value: 0</p>
</div>
<hr>
<div class="refsect2" title='The "moov-recovery-file" property'>
<a name="GstQTMux--moov-recovery-file"></a><h3>The <code class="literal">"moov-recovery-file"</code> property</h3>
<pre class="programlisting">  "moov-recovery-file"       <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gchar"><span class="type">gchar</span></a>*                : Read / Write / Construct</pre>
<p>File to be used to store data for moov atom making movie file recovery possible in case of a crash during muxing. Null for disabled. (Experimental).</p>
<p>Default value: NULL</p>
</div>
<hr>
<div class="refsect2" title='The "movie-timescale" property'>
<a name="GstQTMux--movie-timescale"></a><h3>The <code class="literal">"movie-timescale"</code> property</h3>
<pre class="programlisting">  "movie-timescale"          <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint"><span class="type">guint</span></a>                 : Read / Write / Construct</pre>
<p>Timescale to use in the movie (units per second).</p>
<p>Allowed values: &gt;= 1</p>
<p>Default value: 1000</p>
</div>
<hr>
<div class="refsect2" title='The "presentation-time" property'>
<a name="GstQTMux--presentation-time"></a><h3>The <code class="literal">"presentation-time"</code> property</h3>
<pre class="programlisting">  "presentation-time"        <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gboolean"><span class="type">gboolean</span></a>              : Read / Write / Construct</pre>
<p>Calculate and include presentation/composition time (in addition to decoding time).</p>
<p>Default value: TRUE</p>
</div>
<hr>
<div class="refsect2" title='The "streamable" property'>
<a name="GstQTMux--streamable"></a><h3>The <code class="literal">"streamable"</code> property</h3>
<pre class="programlisting">  "streamable"               <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gboolean"><span class="type">gboolean</span></a>              : Read / Write / Construct</pre>
<p>If set to true, the output should be as if it is to be streamed and hence no indexes written or duration written.</p>
<p>Default value: FALSE</p>
</div>
<hr>
<div class="refsect2" title='The "trak-timescale" property'>
<a name="GstQTMux--trak-timescale"></a><h3>The <code class="literal">"trak-timescale"</code> property</h3>
<pre class="programlisting">  "trak-timescale"           <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint"><span class="type">guint</span></a>                 : Read / Write / Construct</pre>
<p>Timescale to use for the tracks (units per second, 0 is automatic).</p>
<p>Default value: 0</p>
</div>
</div>
</div>
<div class="footer">
<hr>
          Generated by GTK-Doc V1.15</div>
</body>
</html>