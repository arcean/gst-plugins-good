<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>level</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="index.html" title="GStreamer Good Plugins 0.10 Plugins Reference Manual">
<link rel="up" href="ch01.html" title="gst-plugins-good Elements">
<link rel="prev" href="gst-plugins-good-plugins-jpegenc.html" title="jpegenc">
<link rel="next" href="gst-plugins-good-plugins-matroskamux.html" title="matroskamux">
<meta name="generator" content="GTK-Doc V1.15 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="2">
<tr valign="middle">
<td><a accesskey="p" href="gst-plugins-good-plugins-jpegenc.html"><img src="left.png" width="24" height="24" border="0" alt="Prev"></a></td>
<td><a accesskey="u" href="ch01.html"><img src="up.png" width="24" height="24" border="0" alt="Up"></a></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="24" height="24" border="0" alt="Home"></a></td>
<th width="100%" align="center">GStreamer Good Plugins 0.10 Plugins Reference Manual</th>
<td><a accesskey="n" href="gst-plugins-good-plugins-matroskamux.html"><img src="right.png" width="24" height="24" border="0" alt="Next"></a></td>
</tr>
<tr><td colspan="5" class="shortcuts">
<a href="#gst-plugins-good-plugins-level.synopsis" class="shortcut">Top</a>
                   | 
                  <a href="#gst-plugins-good-plugins-level.description" class="shortcut">Description</a>
                   | 
                  <a href="#gst-plugins-good-plugins-level.object-hierarchy" class="shortcut">Object Hierarchy</a>
                   | 
                  <a href="#gst-plugins-good-plugins-level.properties" class="shortcut">Properties</a>
</td></tr>
</table>
<div class="refentry" title="level">
<a name="gst-plugins-good-plugins-level"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2><span class="refentrytitle"><a name="gst-plugins-good-plugins-level.top_of_page"></a>level</span></h2>
<p>level — RMS/Peak/Decaying Peak Level messager for audio/raw</p>
</td>
<td valign="top" align="right"></td>
</tr></table></div>
<div class="refsynopsisdiv" title="Synopsis">
<a name="gst-plugins-good-plugins-level.synopsis"></a><h2>Synopsis</h2>
<a name="GstLevel"></a><pre class="synopsis">                    <a class="link" href="gst-plugins-good-plugins-level.html#GstLevel-struct" title="GstLevel">GstLevel</a>;
</pre>
</div>
<div class="refsect1" title="Object Hierarchy">
<a name="gst-plugins-good-plugins-level.object-hierarchy"></a><h2>Object Hierarchy</h2>
<pre class="synopsis">
  <a href="/usr/share/gtk-doc/html/gobject/gobject-The-Base-Object-Type.html#GObject">GObject</a>
   +----GstObject
         +----GstElement
               +----GstBaseTransform
                     +----GstLevel
</pre>
</div>
<div class="refsect1" title="Properties">
<a name="gst-plugins-good-plugins-level.properties"></a><h2>Properties</h2>
<pre class="synopsis">
  "<a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--interval" title='The "interval" property'>interval</a>"                 <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint64"><span class="type">guint64</span></a>               : Read / Write
  "<a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--message" title='The "message" property'>message</a>"                  <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gboolean"><span class="type">gboolean</span></a>              : Read / Write
  "<a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--peak-falloff" title='The "peak-falloff" property'>peak-falloff</a>"             <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gdouble"><span class="type">gdouble</span></a>               : Read / Write
  "<a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--peak-ttl" title='The "peak-ttl" property'>peak-ttl</a>"                 <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint64"><span class="type">guint64</span></a>               : Read / Write
</pre>
</div>
<div class="refsect1" title="Description">
<a name="gst-plugins-good-plugins-level.description"></a><h2>Description</h2>
<p>
Level analyses incoming audio buffers and, if the <a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--message" title='The "message" property'><span class="type">"message"</span></a> property
is <a href="/usr/share/gtk-doc/html/glib/glib-Standard-Macros.html#TRUE:CAPS"><span class="type">TRUE</span></a>, generates an element message named
<code class="classname">"level"</code>:
after each interval of time given by the <a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--interval" title='The "interval" property'><span class="type">"interval"</span></a> property.
The message's structure contains these fields:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
  <span class="type">GstClockTime</span>
  <code class="classname">"timestamp"</code>:
  the timestamp of the buffer that triggered the message.
  </p></li>
<li class="listitem"><p>
  <span class="type">GstClockTime</span>
  <code class="classname">"stream-time"</code>:
  the stream time of the buffer.
  </p></li>
<li class="listitem"><p>
  <span class="type">GstClockTime</span>
  <code class="classname">"running-time"</code>:
  the running_time of the buffer.
  </p></li>
<li class="listitem"><p>
  <span class="type">GstClockTime</span>
  <code class="classname">"duration"</code>:
  the duration of the buffer.
  </p></li>
<li class="listitem"><p>
  <span class="type">GstClockTime</span>
  <code class="classname">"endtime"</code>:
  the end time of the buffer that triggered the message as stream time (this
  is deprecated, as it can be calculated from stream-time + duration)
  </p></li>
<li class="listitem"><p>
  <span class="type">GstValueList</span> of <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gdouble"><span class="type">gdouble</span></a>
  <code class="classname">"peak"</code>:
  the peak power level in dB for each channel
  </p></li>
<li class="listitem"><p>
  <span class="type">GstValueList</span> of <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gdouble"><span class="type">gdouble</span></a>
  <code class="classname">"decay"</code>:
  the decaying peak power level in dB for each channel
  the decaying peak level follows the peak level, but starts dropping
  if no new peak is reached after the time given by
  the <a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--peak-ttl" title='The "peak-ttl" property'>the time to live</a>.
  When the decaying peak level drops, it does so at the decay rate
  as specified by the
  <a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--peak-falloff" title='The "peak-falloff" property'>the peak falloff rate</a>.
  </p></li>
<li class="listitem"><p>
  <span class="type">GstValueList</span> of <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gdouble"><span class="type">gdouble</span></a>
  <code class="classname">"rms"</code>:
  the Root Mean Square (or average power) level in dB for each channel
  </p></li>
</ul></div>
<p>
</p>
<div class="refsect2" title="Example application">
<a name="id418082"></a><h3>Example application</h3>
<div class="informalexample">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="comment">/*</span><span class="comment"> GStreamer</span>
<span class="comment"> * Copyright (C) 2000,2001,2002,2003,2005</span>
<span class="comment"> *           Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;</span>
<span class="comment"> *</span>
<span class="comment"> * This library is free software; you can redistribute it and/or</span>
<span class="comment"> * modify it under the terms of the GNU Library General Public</span>
<span class="comment"> * License as published by the Free Software Foundation; either</span>
<span class="comment"> * version 2 of the License, or (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> * This library is distributed in the hope that it will be useful,</span>
<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="comment"> * Library General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> * You should have received a copy of the GNU Library General Public</span>
<span class="comment"> * License along with this library; if not, write to the</span>
<span class="comment"> * Free Software Foundation, Inc., 59 Temple Place - Suite 330,</span>
<span class="comment"> * Boston, MA 02111-1307, USA.</span>
<span class="comment"> </span><span class="comment">*/</span>

<span class="preproc">#include </span><span class="number">&lt;string.h&gt;</span>
<span class="preproc">#include </span><span class="number">&lt;math.h&gt;</span>

<span class="preproc">#include </span><span class="number">&lt;gst/gst.h&gt;</span>

<span class="type">static</span> gboolean
message_handler (GstBus * bus, GstMessage * message, gpointer data)
{

  <span class="keyword">if</span> (message-&gt;type == GST_MESSAGE_ELEMENT) {
    <span class="type">const</span> GstStructure *s = gst_message_get_structure (message);
    <span class="type">const</span> gchar *name = gst_structure_get_name (s);

    <span class="keyword">if</span> (strcmp (name, <span class="number">&quot;level&quot;</span>) == <span class="number">0</span>) {
      gint channels;
      GstClockTime endtime;
      gdouble rms_dB, peak_dB, decay_dB;
      gdouble rms;
      <span class="type">const</span> GValue *list;
      <span class="type">const</span> GValue *value;

      gint i;

      <span class="keyword">if</span> (!gst_structure_get_clock_time (s, <span class="number">&quot;endtime&quot;</span>, &amp;endtime))
        g_warning (<span class="number">&quot;Could not parse endtime&quot;</span>);
      <span class="comment">/*</span><span class="comment"> we can get the number of channels as the length of any of the value</span>
<span class="comment">       * lists </span><span class="comment">*/</span>
      list = gst_structure_get_value (s, <span class="number">&quot;rms&quot;</span>);
      channels = gst_value_list_get_size (list);

      g_print (<span class="number">&quot;endtime: %&quot;</span> GST_TIME_FORMAT <span class="number">&quot;, channels: </span><span class="symbol">%d</span><span class="symbol">\n</span><span class="number">&quot;</span>,
          GST_TIME_ARGS (endtime), channels);
      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; channels; ++i) {
        g_print (<span class="number">&quot;channel </span><span class="symbol">%d</span><span class="symbol">\n</span><span class="number">&quot;</span>, i);
        list = gst_structure_get_value (s, <span class="number">&quot;rms&quot;</span>);
        value = gst_value_list_get_value (list, i);
        rms_dB = g_value_get_double (value);
        list = gst_structure_get_value (s, <span class="number">&quot;peak&quot;</span>);
        value = gst_value_list_get_value (list, i);
        peak_dB = g_value_get_double (value);
        list = gst_structure_get_value (s, <span class="number">&quot;decay&quot;</span>);
        value = gst_value_list_get_value (list, i);
        decay_dB = g_value_get_double (value);
        g_print (<span class="number">&quot;    RMS: </span><span class="symbol">%f</span><span class="number"> dB, peak: </span><span class="symbol">%f</span><span class="number"> dB, decay: </span><span class="symbol">%f</span><span class="number"> dB</span><span class="symbol">\n</span><span class="number">&quot;</span>,
            rms_dB, peak_dB, decay_dB);

        <span class="comment">/*</span><span class="comment"> converting from dB to normal gives us a value between 0.0 and 1.0 </span><span class="comment">*/</span>
        rms = pow (<span class="number">10</span>, rms_dB / <span class="number">20</span>);
        g_print (<span class="number">&quot;    normalized rms value: </span><span class="symbol">%f</span><span class="symbol">\n</span><span class="number">&quot;</span>, rms);
      }
    }
  }
  <span class="comment">/*</span><span class="comment"> we handled the message we want, and ignored the ones we didn't want.</span>
<span class="comment">   * so the core can unref the message for us </span><span class="comment">*/</span>
  <span class="keyword">return</span> TRUE;
}

<span class="type">int</span>
main (<span class="type">int</span> argc, <span class="type">char</span> *argv[])
{
  GstElement *audiotestsrc, *audioconvert, *level, *fakesink;
  GstElement *pipeline;
  GstCaps *caps;
  GstBus *bus;
  guint watch_id;
  GMainLoop *loop;

  gst_init (&amp;argc, &amp;argv);

  caps = gst_caps_from_string (<span class="number">&quot;audio/x-raw-int,channels=2&quot;</span>);

  pipeline = gst_pipeline_new (<span class="number">NULL</span>);
  g_assert (pipeline);
  audiotestsrc = gst_element_factory_make (<span class="number">&quot;audiotestsrc&quot;</span>, <span class="number">NULL</span>);
  g_assert (audiotestsrc);
  audioconvert = gst_element_factory_make (<span class="number">&quot;audioconvert&quot;</span>, <span class="number">NULL</span>);
  g_assert (audioconvert);
  level = gst_element_factory_make (<span class="number">&quot;level&quot;</span>, <span class="number">NULL</span>);
  g_assert (level);
  fakesink = gst_element_factory_make (<span class="number">&quot;fakesink&quot;</span>, <span class="number">NULL</span>);
  g_assert (fakesink);

  gst_bin_add_many (GST_BIN (pipeline), audiotestsrc, audioconvert, level,
      fakesink, <span class="number">NULL</span>);
  <span class="keyword">if</span> (!gst_element_link (audiotestsrc, audioconvert))
    g_error (<span class="number">&quot;Failed to link audiotestsrc and audioconvert&quot;</span>);
  <span class="keyword">if</span> (!gst_element_link_filtered (audioconvert, level, caps))
    g_error (<span class="number">&quot;Failed to link audioconvert and level&quot;</span>);
  <span class="keyword">if</span> (!gst_element_link (level, fakesink))
    g_error (<span class="number">&quot;Failed to link level and fakesink&quot;</span>);

  <span class="comment">/*</span><span class="comment"> make sure we'll get messages </span><span class="comment">*/</span>
  g_object_set (G_OBJECT (level), <span class="number">&quot;message&quot;</span>, TRUE, <span class="number">NULL</span>);
  <span class="comment">/*</span><span class="comment"> run synced and not as fast as we can </span><span class="comment">*/</span>
  g_object_set (G_OBJECT (fakesink), <span class="number">&quot;sync&quot;</span>, TRUE, <span class="number">NULL</span>);

  bus = gst_element_get_bus (pipeline);
  watch_id = gst_bus_add_watch (bus, message_handler, <span class="number">NULL</span>);

  gst_element_set_state (pipeline, GST_STATE_PLAYING);

  <span class="comment">/*</span><span class="comment"> we need to run a GLib main loop to get the messages </span><span class="comment">*/</span>
  loop = g_main_loop_new (<span class="number">NULL</span>, FALSE);
  g_main_loop_run (loop);

  g_source_remove (watch_id);
  g_main_loop_unref (loop);
  <span class="keyword">return</span> <span class="number">0</span>;
}</pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
</div>
<div class="refsect1" title="Details">
<a name="gst-plugins-good-plugins-level.details"></a><h2>Details</h2>
<div class="refsect2" title="GstLevel">
<a name="GstLevel-struct"></a><h3>GstLevel</h3>
<pre class="programlisting">typedef struct _GstLevel GstLevel;</pre>
<p>
Opaque data structure.
</p>
</div>
</div>
<div class="refsect1" title="Property Details">
<a name="gst-plugins-good-plugins-level.property-details"></a><h2>Property Details</h2>
<div class="refsect2" title='The "interval" property'>
<a name="GstLevel--interval"></a><h3>The <code class="literal">"interval"</code> property</h3>
<pre class="programlisting">  "interval"                 <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint64"><span class="type">guint64</span></a>               : Read / Write</pre>
<p>Interval of time between message posts (in nanoseconds).</p>
<p>Allowed values: &gt;= 1</p>
<p>Default value: 100000000</p>
</div>
<hr>
<div class="refsect2" title='The "message" property'>
<a name="GstLevel--message"></a><h3>The <code class="literal">"message"</code> property</h3>
<pre class="programlisting">  "message"                  <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gboolean"><span class="type">gboolean</span></a>              : Read / Write</pre>
<p>Post a level message for each passed interval.</p>
<p>Default value: TRUE</p>
</div>
<hr>
<div class="refsect2" title='The "peak-falloff" property'>
<a name="GstLevel--peak-falloff"></a><h3>The <code class="literal">"peak-falloff"</code> property</h3>
<pre class="programlisting">  "peak-falloff"             <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gdouble"><span class="type">gdouble</span></a>               : Read / Write</pre>
<p>Decay rate of decay peak after TTL (in dB/sec).</p>
<p>Allowed values: &gt;= 0</p>
<p>Default value: 10</p>
</div>
<hr>
<div class="refsect2" title='The "peak-ttl" property'>
<a name="GstLevel--peak-ttl"></a><h3>The <code class="literal">"peak-ttl"</code> property</h3>
<pre class="programlisting">  "peak-ttl"                 <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint64"><span class="type">guint64</span></a>               : Read / Write</pre>
<p>Time To Live of decay peak before it falls back (in nanoseconds).</p>
<p>Default value: 300000000</p>
</div>
</div>
</div>
<div class="footer">
<hr>
          Generated by GTK-Doc V1.15</div>
</body>
</html>